<div class="max-w-7xl mx-auto">
  <header class="mb-8">
    <h1 class="text-3xl font-bold text-base-content">Dashboard</h1>
    <p class="mt-1 text-base-content/70">Platform overview and quick actions</p>
  </header>

  @if (loading()) {
    <div class="flex flex-col items-center justify-center py-16 gap-4 text-base-content/70">
      <span class="loading loading-spinner loading-lg text-primary"></span>
      <span>Loading dashboard…</span>
    </div>
  }

  @if (error()) {
    <div role="alert" class="alert alert-error shadow-lg">
      <span>{{ error() }}</span>
    </div>
  }

  @if (hasData()) {
    <div class="flex flex-col gap-8">
      <!-- Overview stats in one card -->
      <section class="card bg-base-100 shadow border border-base-300">
        <div class="card-body">
          <h2 class="card-title text-lg font-semibold mb-4">Overview</h2>

          <div class="divider divider-start text-sm font-medium text-base-content/60 my-2">Channels</div>
          <div class="stats stats-vertical w-full sm:stats-horizontal bg-base-200/50 rounded-lg p-4 mb-4">
            <div class="stat py-0">
              <div class="stat-title text-xs opacity-80">Total</div>
              <div class="stat-value text-2xl text-primary">{{ stats()!.totalChannels }}</div>
            </div>
            <div class="stat py-0">
              <div class="stat-title text-xs opacity-80">Approved</div>
              <div class="stat-value text-2xl text-success">{{ stats()!.channelsByStatus.APPROVED }}</div>
            </div>
            <div class="stat py-0">
              <div class="stat-title text-xs opacity-80">Unapproved</div>
              <div class="stat-value text-2xl text-warning">{{ stats()!.channelsByStatus.UNAPPROVED }}</div>
            </div>
            <div class="stat py-0">
              <div class="stat-title text-xs opacity-80">Trial expiring (7d)</div>
              <div class="stat-value text-2xl">{{ stats()!.trialExpiringSoonCount }}</div>
            </div>
            <div class="stat py-0">
              <div class="stat-title text-xs opacity-80">Active subscriptions</div>
              <div class="stat-value text-2xl">{{ stats()!.activeSubscriptionsCount }}</div>
            </div>
          </div>

          <div class="divider divider-start text-sm font-medium text-base-content/60 my-2">Platform</div>
          <div class="stats stats-vertical w-full sm:stats-horizontal bg-base-200/50 rounded-lg p-4">
            <div class="stat py-0">
              <div class="stat-title text-xs opacity-80">Pending approvals</div>
              <div class="stat-value text-2xl text-warning">{{ pendingCount() }}</div>
            </div>
            <div class="stat py-0">
              <div class="stat-title text-xs opacity-80">Platform admins</div>
              <div class="stat-value text-2xl text-primary">{{ adminsCount() }}</div>
            </div>
            <div class="stat py-0">
              <div class="stat-title text-xs opacity-80">Role templates</div>
              <div class="stat-value text-2xl">{{ roleTemplatesCount() }}</div>
            </div>
            <div class="stat py-0">
              <div class="stat-title text-xs opacity-80">Subscription tiers</div>
              <div class="stat-value text-2xl">{{ subscriptionTiersCount() }}</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Shortcuts as a grid of cards -->
      <section>
        <h2 class="text-lg font-semibold mb-4">Shortcuts</h2>
        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3">
          <a routerLink="/channels" class="card card-compact bg-base-100 border border-base-300 shadow-sm hover:shadow-md hover:border-primary/30 transition-all">
            <div class="card-body items-center text-center py-4 gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 opacity-70" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
              </svg>
              <span class="font-medium">Channels</span>
            </div>
          </a>
          <a routerLink="/pending-registrations" class="card card-compact bg-base-100 border border-base-300 shadow-sm hover:shadow-md hover:border-warning/30 transition-all">
            <div class="card-body items-center text-center py-4 gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 opacity-70" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span class="font-medium">Pending</span>
              @if (pendingCount() > 0) {
                <span class="badge badge-warning badge-sm">{{ pendingCount() }}</span>
              }
            </div>
          </a>
          <a routerLink="/users" class="card card-compact bg-base-100 border border-base-300 shadow-sm hover:shadow-md hover:border-primary/30 transition-all">
            <div class="card-body items-center text-center py-4 gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 opacity-70" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
              </svg>
              <span class="font-medium">Users</span>
            </div>
          </a>
          <a routerLink="/role-templates" class="card card-compact bg-base-100 border border-base-300 shadow-sm hover:shadow-md hover:border-primary/30 transition-all">
            <div class="card-body items-center text-center py-4 gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 opacity-70" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              <span class="font-medium">Templates</span>
              <span class="badge badge-ghost badge-sm">{{ roleTemplatesCount() }}</span>
            </div>
          </a>
          <a routerLink="/subscription-tiers" class="card card-compact bg-base-100 border border-base-300 shadow-sm hover:shadow-md hover:border-primary/30 transition-all">
            <div class="card-body items-center text-center py-4 gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 opacity-70" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
              </svg>
              <span class="font-medium">Tiers</span>
              <span class="badge badge-ghost badge-sm">{{ subscriptionTiersCount() }}</span>
            </div>
          </a>
          <a routerLink="/ml-trainer" class="card card-compact bg-base-100 border border-base-300 shadow-sm hover:shadow-md hover:border-primary/30 transition-all">
            <div class="card-body items-center text-center py-4 gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 opacity-70" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
              </svg>
              <span class="font-medium">ML Trainer</span>
            </div>
          </a>
        </div>
      </section>

      <!-- Channels needing attention -->
      <section class="card bg-base-100 shadow border border-base-300">
        <div class="card-body">
          <div class="flex flex-wrap items-center justify-between gap-2 mb-4">
            <h2 class="card-title text-lg font-semibold">Channels needing attention</h2>
            <a routerLink="/channels" class="btn btn-ghost btn-sm">View all channels</a>
          </div>

          @if (channelsNeedingAttention().length > 0) {
            <div class="overflow-x-auto rounded-lg border border-base-300">
              <table class="table table-zebra table-sm">
                <thead>
                  <tr class="bg-base-200/70">
                    <th class="font-semibold">Code</th>
                    <th class="font-semibold">Status</th>
                    <th class="font-semibold">Trial ends</th>
                    <th class="font-semibold">Subscription</th>
                    <th class="w-20"></th>
                  </tr>
                </thead>
                <tbody>
                  @for (ch of channelsNeedingAttention(); track ch.id) {
                    <tr>
                      <td class="font-medium">{{ ch.code }}</td>
                      <td>
                        <span class="badge badge-sm" [class.badge-warning]="ch.customFields.status === 'UNAPPROVED'" [class.badge-ghost]="ch.customFields.status !== 'UNAPPROVED'">
                          {{ ch.customFields.status }}
                        </span>
                      </td>
                      <td>{{ formatTrialEnd(ch.customFields.trialEndsAt) }}</td>
                      <td>{{ ch.customFields.subscriptionStatus || '—' }}</td>
                      <td>
                        <a [routerLink]="['/channels', ch.id]" class="btn btn-ghost btn-xs">View</a>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          } @else {
            <div class="rounded-lg bg-base-200/50 border border-base-300 border-dashed p-8 text-center">
              <p class="text-base-content/70">No channels need attention right now.</p>
              <a routerLink="/channels" class="btn btn-primary btn-sm mt-3">View all channels</a>
            </div>
          }
        </div>
      </section>
    </div>
  }
</div>
