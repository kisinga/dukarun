<!-- Toast Notification -->
@if (notificationMessage()) {
  <div class="toast toast-top toast-center z-50 animate-in">
    <div
      class="alert shadow-lg"
      [class.alert-success]="notificationType() === 'success'"
      [class.alert-warning]="notificationType() === 'warning'"
      [class.alert-error]="notificationType() === 'error'"
    >
      <span class="text-sm">{{ notificationMessage() }}</span>
    </div>
  </div>
}

<!-- Main Content -->
<div class="container-app py-3 space-y-3 pb-6">
  <!-- Search View -->
  <app-search-view
    [searchResults]="searchResults()"
    [isSearching]="isSearching()"
    [showCameraButton]="isManualSearchActive()"
    (searchTermChange)="handleSearchTermChange($event)"
    (productSelected)="handleProductSelected($event)"
    (cameraToggle)="handleClearSearch()"
  />

  <!-- Camera (conditional) -->
  @if (shouldShowCamera()) {
    <app-product-scanner
      #scanner
      [channelId]="channelId()"
      [autoStartOnMobile]="true"
      (scannerReady)="handleScannerReady(scanner)"
      (scanningStateChange)="handleScanningStateChange($event)"
      (productDetected)="handleProductDetected($event)"
    />
  }

  <!-- Empty State (only when searching but no results) -->
  @if (isManualSearchActive() && searchResults().length === 0 && !isSearching()) {
    <div class="text-center py-12">
      <div class="text-5xl mb-2">üîç</div>
      <p class="font-semibold">No products found</p>
      <p class="text-sm opacity-60 mt-1">Try a different search term</p>
    </div>
  }

  <!-- Inline Cart -->
  @if (cartItems().length > 0) {
    <app-cart
      [items]="cartItems()"
      [canOverridePrices]="canOverridePrices()"
      [displayMode]="'inline'"
      (quantityChange)="handleCartQuantityChange($event)"
      (priceChange)="handlePriceOverrideChange($event)"
      (removeItem)="handleCartItemRemove($event)"
      (clearCart)="handleClearCart()"
    />
  }
</div>

<!-- Checkout FAB -->
@if (cartItems().length > 0) {
  <app-checkout-fab [total]="cartTotal()" (checkout)="handleProceedToCheckout()" />
}

<!-- Product Confirmation Modal -->
<app-product-confirm-modal
  [isOpen]="showConfirmModal()"
  [product]="detectedProduct()"
  [canOverridePrices]="canOverridePrices()"
  (variantSelected)="handleVariantSelected($event)"
  (closeModal)="handleConfirmModalClose()"
/>

<!-- Clear Cart Confirmation Modal -->
@if (showClearCartConfirm()) {
  <div class="modal modal-open modal-bottom sm:modal-middle animate-in fade-in duration-300">
    <div class="modal-box animate-in slide-in-from-bottom-4 duration-300">
      <h3 class="font-bold text-lg text-error mb-4">Clear Cart</h3>
      <p class="py-4">
        Are you sure you want to clear all items from your cart? This action cannot be undone.
      </p>
      <div class="modal-action">
        <button class="btn btn-ghost" (click)="handleCancelClearCart()">Cancel</button>
        <button class="btn btn-error" (click)="handleConfirmClearCart()">Clear Cart</button>
      </div>
    </div>
  </div>
}

<!-- Checkout Modal -->
<app-checkout-modal
  [isOpen]="showCheckoutModal()"
  [checkoutType]="checkoutType()"
  [itemCount]="cartItemCount()"
  [total]="cartTotal()"
  [error]="checkoutError()"
  [isProcessing]="isProcessingCheckout()"
  [cashierFlowEnabled]="cashierFlowEnabled()"
  [selectedCustomer]="selectedCustomer()"
  [customerSearchResults]="customerSearchResults()"
  [isSearchingCustomers]="isSearchingCustomers()"
  [selectedPaymentMethod]="selectedPaymentMethod()"
  (completeCashier)="handleCompleteCashier()"
  (completeCredit)="handleCompleteCredit()"
  (completeCash)="handleCompleteCash()"
  (customerSearch)="handleCustomerSearch($event)"
  (customerSelect)="handleCustomerSelect($event)"
  (customerCreate)="handleCustomerCreate($event)"
  (paymentMethodSelect)="handlePaymentMethodSelect($event)"
  (selectCredit)="handleCheckoutCredit()"
  (selectCash)="handleCheckoutCash()"
  (selectCashier)="handleCheckoutCashier()"
  (closeModal)="handleCheckoutModalClose()"
/>
