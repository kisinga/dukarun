<div class="space-y-2">
  <!-- Existing stat cards (always visible) -->
  <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3">
    <!-- Total Products -->
    <div class="rounded-xl p-2.5 sm:p-3 bg-primary/5 border-l-[3px] border-primary shadow-sm">
      <span
        class="text-[10px] sm:text-[11px] font-semibold uppercase tracking-wider text-base-content/50 block mb-0.5"
      >
        Products
      </span>
      <p class="text-lg sm:text-xl font-bold text-primary tabular-nums leading-none">
        {{ stats().totalProducts }}
      </p>
    </div>

    <!-- Total Variants -->
    <div class="rounded-xl p-2.5 sm:p-3 bg-secondary/5 border-l-[3px] border-secondary shadow-sm">
      <span
        class="text-[10px] sm:text-[11px] font-semibold uppercase tracking-wider text-base-content/50 block mb-0.5"
      >
        Variants
      </span>
      <p class="text-lg sm:text-xl font-bold text-secondary tabular-nums leading-none">
        {{ stats().totalVariants }}
      </p>
    </div>

    <!-- Total Stock -->
    <div class="rounded-xl p-2.5 sm:p-3 bg-success/5 border-l-[3px] border-success shadow-sm">
      <span
        class="text-[10px] sm:text-[11px] font-semibold uppercase tracking-wider text-base-content/50 block mb-0.5"
      >
        In Stock
      </span>
      <p class="text-lg sm:text-xl font-bold text-success tabular-nums leading-none">
        {{ stats().totalStock }}
      </p>
    </div>

    <!-- Low Stock -->
    <button
      type="button"
      class="rounded-xl p-2.5 sm:p-3 text-left bg-warning/5 border-l-[3px] border-warning shadow-sm hover:shadow-md active:scale-[0.97] transition-all touch-manipulation"
      [class.ring-2]="lowStockActive()"
      [class.ring-warning]="lowStockActive()"
      (click)="onLowStockClick()"
    >
      <span
        class="text-[10px] sm:text-[11px] font-semibold uppercase tracking-wider text-base-content/50 block mb-0.5"
      >
        Low Stock
      </span>
      <p class="text-lg sm:text-xl font-bold text-warning tabular-nums leading-none">
        {{ stats().lowStock }}
      </p>
    </button>
  </div>

  <!-- Analytics toggle -->
  <button
    type="button"
    class="w-full flex items-center justify-between px-3 py-2 rounded-lg bg-base-200/60 hover:bg-base-200 transition-colors touch-manipulation text-left"
    (click)="toggleAnalytics()"
  >
    <span class="text-xs font-semibold text-base-content/60 uppercase tracking-wide"
      >Analytics</span
    >
    <svg
      class="h-3.5 w-3.5 text-base-content/30 transition-transform duration-200"
      [class.rotate-180]="analyticsOpen()"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      stroke-width="2"
    >
      <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
    </svg>
  </button>

  <!-- Collapsible analytics section -->
  <div class="collapsible" [class.open]="analyticsOpen()">
    <div class="space-y-3 pt-1">
      <!-- Period selector -->
      <app-period-selector
        [selected]="selectedPeriod()"
        (selectedChange)="onPeriodChange($event)"
      />

      @if (analyticsLoading()) {
        <div class="flex items-center justify-center py-6">
          <span class="loading loading-spinner loading-sm text-primary"></span>
        </div>
      } @else {
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <!-- Top Selling -->
          <div class="rounded-xl border border-base-300 bg-base-100 p-3">
            <p class="text-[11px] font-semibold uppercase tracking-wide text-base-content/50 mb-2">
              Top Selling
            </p>
            @if (topSellingItems().length === 0) {
              <p class="text-xs text-base-content/40 text-center py-3">No sales data</p>
            } @else {
              <app-ranked-list [items]="topSellingItems()" barColor="primary" />
            }
          </div>

          <!-- Highest Margin -->
          <div class="rounded-xl border border-base-300 bg-base-100 p-3">
            <p class="text-[11px] font-semibold uppercase tracking-wide text-base-content/50 mb-2">
              Highest Margin
            </p>
            @if (highestMarginItems().length === 0) {
              <p class="text-xs text-base-content/40 text-center py-3">No margin data</p>
            } @else {
              <app-ranked-list [items]="highestMarginItems()" barColor="success" />
            }
          </div>
        </div>
      }
    </div>
  </div>
</div>
